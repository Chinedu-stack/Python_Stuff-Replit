import sqlite3
import os

# --- FILE PATH
basedir = os.path.abspath(os.path.dirname(__file__))
db_path = os.path.join(basedir, "study_tracker.db")

conn = sqlite3.connect(db_path)
cursor = conn.cursor()

cursor.execute("""CREATE TABLE IF NOT EXISTS sessions(
               id INTEGER PRIMARY KEY AUTOINCREMENT,
               subject TEXT NOT NULL,
               topic TEXT NOT NULL,
               duration REAL NOT NULL,
               date TEXT NOT NULL
               )""")

###----Insert values function
def add(subject, topic, duration, date):
    cursor.execute("INSERT INTO sessions (subject, topic, duration, date) VALUES (?,?,?,?)", (subject, topic, duration, date))
    conn.commit()

#### -----FILTERING SUBROUTINE----------

def where(column, value):

    allowed_columns = ["subject", "topic", "duration", "date"]

    if column not in allowed_columns:
        print("Invalid column name")
        return

    query = f"SELECT * FROM sessions WHERE {column} = ?"

    cursor.execute(query, (value,))
    rows = cursor.fetchall()

    for row in rows:
        print(row)

# add("biology", "kinestetic", 6, "monday")
# add("biology", "glucose", 5, "tuesday")
# add("thursday", "stuff", 3,"sunday")
# print("success")

# cursor.execute("""SELECT * FROM sessions
#                WHERE subject = ? OR duration > ? """, ("biology", 2))


cursor.execute(
    "SELECT * FROM sessions WHERE (subject = ? OR subject = ?) AND duration > ?",
    ("maths", "english", 1)
)



rows = cursor.fetchall()
for row in rows:
    print(row)

